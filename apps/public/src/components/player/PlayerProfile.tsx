'use client';\n\nimport { useState } from 'react';\nimport { User, Calendar, Star, Settings, AlertCircle } from 'lucide-react';\nimport { \n  PlayerAgeGroup, \n  PlayerAgeGroupLabels, \n  PlayerProfileAgeInput \n} from '../../../shared/types/age-restriction.types';\n\ninterface PlayerProfileProps {\n  player?: {\n    id?: string;\n    email?: string;\n    firstName?: string;\n    lastName?: string;\n    phone?: string;\n    ageGroup?: PlayerAgeGroup;\n    fargoRating?: number;\n    apaEightBallRank?: string;\n    apaNineBallRank?: string;\n    inHouseRating?: string;\n  };\n  onSave: (profileData: any) => void;\n  isSignup?: boolean;\n  canEditAge?: boolean;\n}\n\nexport function PlayerProfile({ \n  player, \n  onSave, \n  isSignup = false, \n  canEditAge = true \n}: PlayerProfileProps) {\n  const [formData, setFormData] = useState({\n    firstName: player?.firstName || '',\n    lastName: player?.lastName || '',\n    email: player?.email || '',\n    phone: player?.phone || '',\n    ageGroup: player?.ageGroup || PlayerAgeGroup.AGES_21_PLUS,\n    fargoRating: player?.fargoRating || '',\n    apaEightBallRank: player?.apaEightBallRank || '',\n    apaNineBallRank: player?.apaNineBallRank || '',\n    inHouseRating: player?.inHouseRating || ''\n  });\n\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleInputChange = (field: string, value: any) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n    setError(''); // Clear error when user makes changes\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      // Validate required fields\n      if (!formData.firstName.trim() || !formData.lastName.trim() || !formData.email.trim()) {\n        throw new Error('First name, last name, and email are required');\n      }\n\n      // Email validation\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      if (!emailRegex.test(formData.email)) {\n        throw new Error('Please enter a valid email address');\n      }\n\n      // Phone validation (if provided)\n      if (formData.phone && formData.phone.length > 0) {\n        const phoneRegex = /^[\\d\\s\\-\\(\\)\\+\\.]{10,}$/;\n        if (!phoneRegex.test(formData.phone.replace(/\\s/g, ''))) {\n          throw new Error('Please enter a valid phone number');\n        }\n      }\n\n      // Convert fargo rating to number if provided\n      const profileData = {\n        ...formData,\n        fargoRating: formData.fargoRating ? parseInt(formData.fargoRating.toString()) : undefined\n      };\n\n      await onSave(profileData);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n      <div className=\"flex items-center gap-3 mb-6\">\n        <User className=\"h-6 w-6 text-purple-600\" />\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n          {isSignup ? 'Create Player Profile' : 'Edit Player Profile'}\n        </h2>\n      </div>\n\n      {error && (\n        <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2\">\n          <AlertCircle className=\"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0\" />\n          <span className=\"text-red-700 dark:text-red-300\">{error}</span>\n        </div>\n      )}\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {/* Basic Information */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              First Name *\n            </label>\n            <input\n              type=\"text\"\n              value={formData.firstName}\n              onChange={(e) => handleInputChange('firstName', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n              required\n              disabled={loading}\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              Last Name *\n            </label>\n            <input\n              type=\"text\"\n              value={formData.lastName}\n              onChange={(e) => handleInputChange('lastName', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n              required\n              disabled={loading}\n            />\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            Email Address *\n          </label>\n          <input\n            type=\"email\"\n            value={formData.email}\n            onChange={(e) => handleInputChange('email', e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n            required\n            disabled={loading || !isSignup} // Email can't be changed after signup\n          />\n          {!isSignup && (\n            <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n              Email address cannot be changed after registration\n            </p>\n          )}\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            Phone Number\n          </label>\n          <input\n            type=\"tel\"\n            value={formData.phone}\n            onChange={(e) => handleInputChange('phone', e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n            disabled={loading}\n            placeholder=\"(555) 123-4567\"\n          />\n        </div>\n\n        {/* Age Group Selection */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            Age Group * \n            <span className=\"text-xs text-gray-500 ml-1\">(Used for age-restricted venues and tournaments)</span>\n          </label>\n          <select\n            value={formData.ageGroup}\n            onChange={(e) => handleInputChange('ageGroup', e.target.value as PlayerAgeGroup)}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n            required\n            disabled={loading || !canEditAge}\n          >\n            {Object.entries(PlayerAgeGroupLabels).map(([value, label]) => (\n              <option key={value} value={value}>\n                {label}\n              </option>\n            ))}\n          </select>\n          {!canEditAge && (\n            <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n              Age group can only be changed by tournament directors during tournament registration\n            </p>\n          )}\n        </div>\n\n        {/* Skill Ratings */}\n        <div className=\"border-t border-gray-200 dark:border-gray-600 pt-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\n            <Star className=\"h-5 w-5\" />\n            Skill Ratings (Optional)\n          </h3>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Fargo Rating\n              </label>\n              <input\n                type=\"number\"\n                value={formData.fargoRating}\n                onChange={(e) => handleInputChange('fargoRating', e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                disabled={loading}\n                placeholder=\"300-800\"\n                min=\"-100\"\n                max=\"900\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                In-House Rating\n              </label>\n              <input\n                type=\"text\"\n                value={formData.inHouseRating}\n                onChange={(e) => handleInputChange('inHouseRating', e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                disabled={loading}\n                placeholder=\"A, B, C, etc.\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                APA 8-Ball Rank\n              </label>\n              <select\n                value={formData.apaEightBallRank}\n                onChange={(e) => handleInputChange('apaEightBallRank', e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                disabled={loading}\n              >\n                <option value=\"\">Select APA 8-Ball Rank</option>\n                <option value=\"2\">2</option>\n                <option value=\"3\">3</option>\n                <option value=\"4\">4</option>\n                <option value=\"5\">5</option>\n                <option value=\"6\">6</option>\n                <option value=\"7\">7</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                APA 9-Ball Rank\n              </label>\n              <select\n                value={formData.apaNineBallRank}\n                onChange={(e) => handleInputChange('apaNineBallRank', e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                disabled={loading}\n              >\n                <option value=\"\">Select APA 9-Ball Rank</option>\n                <option value=\"1\">1</option>\n                <option value=\"2\">2</option>\n                <option value=\"3\">3</option>\n                <option value=\"4\">4</option>\n                <option value=\"5\">5</option>\n                <option value=\"6\">6</option>\n                <option value=\"7\">7</option>\n                <option value=\"8\">8</option>\n                <option value=\"9\">9</option>\n              </select>\n            </div>\n          </div>\n        </div>\n\n        {/* Submit Buttons */}\n        <div className=\"flex gap-4 pt-6\">\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"flex-1 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2\"\n          >\n            {loading ? (\n              <>\n                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\n                {isSignup ? 'Creating Profile...' : 'Saving Changes...'}\n              </>\n            ) : (\n              <>\n                <Settings className=\"h-5 w-5\" />\n                {isSignup ? 'Create Profile' : 'Save Changes'}\n              </>\n            )}\n          </button>\n        </div>\n      </form>\n\n      {/* Age Group Information */}\n      <div className=\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\n        <h4 className=\"font-semibold text-blue-900 dark:text-blue-100 mb-2\">Age Group Information</h4>\n        <div className=\"text-sm text-blue-800 dark:text-blue-200 space-y-1\">\n          <p><strong>&lt;18:</strong> Players under 18 years old (Minors)</p>\n          <p><strong>18-20:</strong> Players aged 18 to 20 years old</p>\n          <p><strong>21+:</strong> Players 21 years old and above</p>\n          <p className=\"mt-2 text-xs text-blue-600 dark:text-blue-300\">\n            Age groups are used to determine tournament eligibility and table assignments based on venue restrictions. \n            Tournament directors can temporarily override age settings for specific tournaments if needed.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}"