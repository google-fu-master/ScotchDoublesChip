'use client';\n\nimport { useState } from 'react';\nimport { AlertTriangle, User, Calendar, X, Check } from 'lucide-react';\nimport { \n  PlayerAgeGroup, \n  PlayerAgeGroupLabels,\n  AgeRestrictionService\n} from '../../../shared/types/age-restriction.types';\n\ninterface Player {\n  id: string;\n  firstName: string;\n  lastName: string;\n  ageGroup: PlayerAgeGroup;\n}\n\ninterface PlayerAgeOverrideProps {\n  player: Player;\n  tournamentId: string;\n  tournamentName: string;\n  onOverride: (playerId: string, overrideAge: PlayerAgeGroup, reason?: string) => Promise<void>;\n  onCancel: () => void;\n  isOpen: boolean;\n}\n\nexport function PlayerAgeOverrideModal({ \n  player, \n  tournamentId,\n  tournamentName,\n  onOverride, \n  onCancel, \n  isOpen \n}: PlayerAgeOverrideProps) {\n  const [selectedAge, setSelectedAge] = useState<PlayerAgeGroup>(player.ageGroup);\n  const [reason, setReason] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [showWarning, setShowWarning] = useState(false);\n\n  if (!isOpen) return null;\n\n  const handleAgeChange = (newAge: PlayerAgeGroup) => {\n    setSelectedAge(newAge);\n    if (newAge !== player.ageGroup) {\n      setShowWarning(true);\n    } else {\n      setShowWarning(false);\n    }\n  };\n\n  const handleConfirm = async () => {\n    if (selectedAge === player.ageGroup) {\n      onCancel();\n      return;\n    }\n\n    setLoading(true);\n    try {\n      await onOverride(player.id, selectedAge, reason.trim() || undefined);\n    } catch (error) {\n      console.error('Failed to override age:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const warningMessage = AgeRestrictionService.generateAgeOverrideWarning(\n    `${player.firstName} ${player.lastName}`,\n    player.ageGroup,\n    selectedAge\n  );\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <User className=\"h-5 w-5\" />\n              Override Player Age Setting\n            </h3>\n            <button\n              onClick={onCancel}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              disabled={loading}\n            >\n              <X className=\"h-6 w-6\" />\n            </button>\n          </div>\n\n          <div className=\"space-y-4\">\n            {/* Player Info */}\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <div className=\"text-sm text-gray-600 dark:text-gray-300 mb-1\">Player</div>\n              <div className=\"font-semibold text-gray-900 dark:text-white\">\n                {player.firstName} {player.lastName}\n              </div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-300 mt-1\">\n                Current Age Group: <span className=\"font-medium\">{PlayerAgeGroupLabels[player.ageGroup]}</span>\n              </div>\n            </div>\n\n            {/* Tournament Info */}\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <div className=\"text-sm text-gray-600 dark:text-gray-300 mb-1\">Tournament</div>\n              <div className=\"font-semibold text-gray-900 dark:text-white\">{tournamentName}</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-300 mt-1\">\n                Override will expire when tournament ends\n              </div>\n            </div>\n\n            {/* Age Group Selector */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Temporary Age Group for This Tournament\n              </label>\n              <select\n                value={selectedAge}\n                onChange={(e) => handleAgeChange(e.target.value as PlayerAgeGroup)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                disabled={loading}\n              >\n                {Object.entries(PlayerAgeGroupLabels).map(([value, label]) => (\n                  <option key={value} value={value}>\n                    {label} {value === player.ageGroup ? '(Current)' : ''}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            {/* Reason (Optional) */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Reason for Override (Optional)\n              </label>\n              <textarea\n                value={reason}\n                onChange={(e) => setReason(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                disabled={loading}\n                rows={3}\n                placeholder=\"Optional reason for this age override...\"\n              />\n            </div>\n\n            {/* Warning Message */}\n            {showWarning && (\n              <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\n                <div className=\"flex items-start gap-2\">\n                  <AlertTriangle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5\" />\n                  <div className=\"text-sm text-yellow-800 dark:text-yellow-200\">\n                    {warningMessage}\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Action Buttons */}\n            <div className=\"flex gap-3 pt-4\">\n              <button\n                onClick={onCancel}\n                disabled={loading}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleConfirm}\n                disabled={loading}\n                className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2\"\n              >\n                {loading ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                    Applying...\n                  </>\n                ) : (\n                  <>\n                    <Check className=\"h-4 w-4\" />\n                    Apply Override\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Component for displaying current age overrides\ninterface PlayerAgeOverrideListProps {\n  overrides: Array<{\n    id: string;\n    playerId: string;\n    player: {\n      firstName: string;\n      lastName: string;\n    };\n    originalAge: PlayerAgeGroup;\n    overrideAge: PlayerAgeGroup;\n    reason?: string;\n    createdAt: Date;\n  }>;\n  onRemove: (overrideId: string) => Promise<void>;\n}\n\nexport function PlayerAgeOverrideList({ overrides, onRemove }: PlayerAgeOverrideListProps) {\n  const [removingId, setRemovingId] = useState<string | null>(null);\n\n  const handleRemove = async (overrideId: string) => {\n    setRemovingId(overrideId);\n    try {\n      await onRemove(overrideId);\n    } catch (error) {\n      console.error('Failed to remove override:', error);\n    } finally {\n      setRemovingId(null);\n    }\n  };\n\n  if (overrides.length === 0) {\n    return (\n      <div className=\"text-center py-6 text-gray-500 dark:text-gray-400\">\n        No age overrides currently active for this tournament.\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      {overrides.map((override) => (\n        <div key={override.id} className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\n          <div className=\"flex items-start justify-between\">\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <User className=\"h-4 w-4 text-yellow-600 dark:text-yellow-400\" />\n                <span className=\"font-semibold text-gray-900 dark:text-white\">\n                  {override.player.firstName} {override.player.lastName}\n                </span>\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">•</span>\n                <span className=\"text-sm text-yellow-700 dark:text-yellow-300\">\n                  Override Active\n                </span>\n              </div>\n              \n              <div className=\"mt-1 text-sm text-gray-600 dark:text-gray-300\">\n                <span className=\"font-medium\">Original:</span> {PlayerAgeGroupLabels[override.originalAge]}\n                {' → '}\n                <span className=\"font-medium\">Override:</span> {PlayerAgeGroupLabels[override.overrideAge]}\n              </div>\n              \n              {override.reason && (\n                <div className=\"mt-1 text-sm text-gray-600 dark:text-gray-300\">\n                  <span className=\"font-medium\">Reason:</span> {override.reason}\n                </div>\n              )}\n              \n              <div className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n                Created: {new Date(override.createdAt).toLocaleDateString()} at {new Date(override.createdAt).toLocaleTimeString()}\n              </div>\n            </div>\n            \n            <button\n              onClick={() => handleRemove(override.id)}\n              disabled={removingId === override.id}\n              className=\"ml-4 px-3 py-1 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 disabled:opacity-50\"\n            >\n              {removingId === override.id ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-current\"></div>\n              ) : (\n                'Remove'\n              )}\n            </button>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}"