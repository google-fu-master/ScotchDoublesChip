'use client';\n\nimport { useState, useEffect } from 'react';\nimport { AlertTriangle, X, CheckCircle, XCircle, Users, Clock, AlertCircle } from 'lucide-react';\nimport { \n  AgeRestrictionConflict, \n  AgeRestrictionWarning,\n  AgeRestrictionService \n} from '../../../shared/types/age-restriction.types';\n\ninterface Player {\n  id: string;\n  firstName: string;\n  lastName: string;\n  ageGroup: string;\n}\n\ninterface AgeConflictNotificationProps {\n  conflicts: AgeRestrictionConflict[];\n  warnings: AgeRestrictionWarning[];\n  onResolve?: (action: 'override' | 'remove' | 'ignore', data?: any) => void;\n  onClose: () => void;\n  isVisible: boolean;\n  title?: string;\n  players?: Player[];\n  playersToRemove?: Player[];\n}\n\nexport function AgeConflictNotification({\n  conflicts,\n  warnings,\n  onResolve,\n  onClose,\n  isVisible,\n  title = 'Age Restriction Conflicts',\n  players = [],\n  playersToRemove = []\n}: AgeConflictNotificationProps) {\n  const [selectedAction, setSelectedAction] = useState<'override' | 'remove' | 'ignore' | null>(null);\n  const [loading, setLoading] = useState(false);\n  \n  if (!isVisible || (conflicts.length === 0 && warnings.length === 0)) {\n    return null;\n  }\n\n  const hasErrors = conflicts.some(c => c.severity === 'ERROR');\n  const hasWarnings = conflicts.some(c => c.severity === 'WARNING') || warnings.length > 0;\n\n  const handleAction = async (action: 'override' | 'remove' | 'ignore') => {\n    if (!onResolve) return;\n    \n    setLoading(true);\n    setSelectedAction(action);\n    \n    try {\n      await onResolve(action, {\n        conflicts,\n        warnings,\n        players: action === 'remove' ? playersToRemove : players\n      });\n    } catch (error) {\n      console.error('Error resolving age conflicts:', error);\n    } finally {\n      setLoading(false);\n      setSelectedAction(null);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <AlertTriangle className={`h-6 w-6 ${\n                hasErrors ? 'text-red-600' : 'text-yellow-600'\n              }`} />\n              {title}\n            </h3>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              disabled={loading}\n            >\n              <X className=\"h-6 w-6\" />\n            </button>\n          </div>\n\n          {/* Conflicts */}\n          {conflicts.length > 0 && (\n            <div className=\"mb-6\">\n              <h4 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n                <XCircle className=\"h-5 w-5 text-red-600\" />\n                Conflicts ({conflicts.length})\n              </h4>\n              <div className=\"space-y-3\">\n                {conflicts.map((conflict, index) => (\n                  <div key={index} className={`p-4 rounded-lg border ${\n                    conflict.severity === 'ERROR' \n                      ? 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'\n                      : 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800'\n                  }`}>\n                    <div className=\"flex items-start gap-2\">\n                      {conflict.severity === 'ERROR' ? (\n                        <XCircle className=\"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5\" />\n                      ) : (\n                        <AlertTriangle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5\" />\n                      )}\n                      <div>\n                        <div className={`font-medium ${\n                          conflict.severity === 'ERROR'\n                            ? 'text-red-800 dark:text-red-200'\n                            : 'text-yellow-800 dark:text-yellow-200'\n                        }`}>\n                          {conflict.type === 'PLAYER_INELIGIBLE' && 'Player Ineligible'}\n                          {conflict.type === 'TABLE_UNAVAILABLE' && 'Table Unavailable'}\n                          {conflict.type === 'TIME_RESTRICTION' && 'Time Restriction'}\n                          {conflict.type === 'LAST_TABLE' && 'Last Available Table'}\n                        </div>\n                        <div className={`text-sm mt-1 ${\n                          conflict.severity === 'ERROR'\n                            ? 'text-red-700 dark:text-red-300'\n                            : 'text-yellow-700 dark:text-yellow-300'\n                        }`}>\n                          {conflict.message}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Warnings */}\n          {warnings.length > 0 && (\n            <div className=\"mb-6\">\n              <h4 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n                <AlertCircle className=\"h-5 w-5 text-blue-600\" />\n                Warnings ({warnings.length})\n              </h4>\n              <div className=\"space-y-3\">\n                {warnings.map((warning, index) => (\n                  <div key={index} className=\"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\n                    <div className=\"flex items-start gap-2\">\n                      <AlertCircle className=\"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\n                      <div>\n                        <div className=\"font-medium text-blue-800 dark:text-blue-200\">\n                          {warning.type === 'OVERRIDE_REQUIRED' && 'Age Override Required'}\n                          {warning.type === 'TIME_CONFLICT' && 'Time Conflict'}\n                          {warning.type === 'LAST_TABLE' && 'Last Table Warning'}\n                        </div>\n                        <div className=\"text-sm text-blue-700 dark:text-blue-300 mt-1\">\n                          {warning.message}\n                        </div>\n                        {warning.affectedPlayers && warning.affectedPlayers.length > 0 && (\n                          <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-2\">\n                            Affected Players: {warning.affectedPlayers.length}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Player Removal Warning */}\n          {playersToRemove.length > 0 && (\n            <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n              <h4 className=\"font-medium text-red-900 dark:text-red-100 mb-2 flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                Players to be Removed\n              </h4>\n              <div className=\"text-sm text-red-800 dark:text-red-200 mb-3\">\n                {AgeRestrictionService.generatePlayerRemovalWarning(playersToRemove)}\n              </div>\n              <div className=\"space-y-1\">\n                {playersToRemove.map((player, index) => (\n                  <div key={index} className=\"text-sm text-red-700 dark:text-red-300\">\n                    â€¢ {player.firstName} {player.lastName} ({player.ageGroup})\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Resolution Actions */}\n          {onResolve && (\n            <div className=\"border-t border-gray-200 dark:border-gray-600 pt-6\">\n              <h4 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">Resolution Options</h4>\n              \n              <div className=\"space-y-3\">\n                {/* Override Ages */}\n                {conflicts.some(c => c.type === 'PLAYER_INELIGIBLE' && c.playerId) && (\n                  <button\n                    onClick={() => handleAction('override')}\n                    disabled={loading}\n                    className=\"w-full p-4 text-left border border-purple-200 dark:border-purple-800 rounded-lg hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors disabled:opacity-50\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <CheckCircle className=\"h-5 w-5 text-purple-600\" />\n                      <div>\n                        <div className=\"font-medium text-gray-900 dark:text-white\">Temporarily Override Age Settings</div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          Allow affected players to participate by temporarily changing their age settings for this tournament only\n                        </div>\n                      </div>\n                    </div>\n                  </button>\n                )}\n                \n                {/* Remove Players */}\n                {hasErrors && (\n                  <button\n                    onClick={() => handleAction('remove')}\n                    disabled={loading}\n                    className=\"w-full p-4 text-left border border-red-200 dark:border-red-800 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors disabled:opacity-50\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <XCircle className=\"h-5 w-5 text-red-600\" />\n                      <div>\n                        <div className=\"font-medium text-gray-900 dark:text-white\">Remove Ineligible Players</div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          Remove all players who cannot participate due to age restrictions\n                        </div>\n                      </div>\n                    </div>\n                  </button>\n                )}\n                \n                {/* Ignore (only for warnings) */}\n                {!hasErrors && hasWarnings && (\n                  <button\n                    onClick={() => handleAction('ignore')}\n                    disabled={loading}\n                    className=\"w-full p-4 text-left border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <AlertCircle className=\"h-5 w-5 text-gray-600\" />\n                      <div>\n                        <div className=\"font-medium text-gray-900 dark:text-white\">Proceed Anyway</div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          Continue with current settings (warnings only, no critical errors)\n                        </div>\n                      </div>\n                    </div>\n                  </button>\n                )}\n              </div>\n              \n              {loading && (\n                <div className=\"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\n                  <div className=\"flex items-center gap-2 text-blue-800 dark:text-blue-200\">\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-current\"></div>\n                    <span className=\"text-sm\">\n                      {selectedAction === 'override' && 'Creating age overrides...'}\n                      {selectedAction === 'remove' && 'Removing players...'}\n                      {selectedAction === 'ignore' && 'Processing...'}\n                    </span>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Close Button */}\n          {!onResolve && (\n            <div className=\"flex justify-end pt-6 border-t border-gray-200 dark:border-gray-600\">\n              <button\n                onClick={onClose}\n                className=\"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg\"\n              >\n                Close\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Hook for managing age conflict notifications\nexport function useAgeConflictNotifications() {\n  const [notification, setNotification] = useState<{\n    conflicts: AgeRestrictionConflict[];\n    warnings: AgeRestrictionWarning[];\n    title?: string;\n    players?: any[];\n    playersToRemove?: any[];\n    onResolve?: (action: string, data?: any) => void;\n  } | null>(null);\n\n  const showNotification = (config: {\n    conflicts: AgeRestrictionConflict[];\n    warnings: AgeRestrictionWarning[];\n    title?: string;\n    players?: any[];\n    playersToRemove?: any[];\n    onResolve?: (action: string, data?: any) => void;\n  }) => {\n    setNotification(config);\n  };\n\n  const hideNotification = () => {\n    setNotification(null);\n  };\n\n  return {\n    notification,\n    showNotification,\n    hideNotification\n  };\n}"