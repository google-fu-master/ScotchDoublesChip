import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '../../../../../shared/database/client';\n\n/**\n * PUT /api/venues/[venueId]/ownership\n * Transfer venue ownership to another user\n */\nexport async function PUT(request: NextRequest, { params }: { params: { venueId: string } }) {\n  try {\n    const { venueId } = params;\n    const body = await request.json();\n    const { currentOwnerId, newOwnerId, reason } = body;\n\n    if (!currentOwnerId || !newOwnerId) {\n      return NextResponse.json(\n        { error: 'Current owner ID and new owner ID are required' },\n        { status: 400 }\n      );\n    }\n\n    // Verify venue exists and current user is the owner\n    const venue = await prisma.venue.findUnique({\n      where: { id: venueId },\n      include: { owner: true }\n    });\n\n    if (!venue) {\n      return NextResponse.json(\n        { error: 'Venue not found' },\n        { status: 404 }\n      );\n    }\n\n    if (venue.ownerId !== currentOwnerId) {\n      return NextResponse.json(\n        { error: 'Only the current venue owner can transfer ownership' },\n        { status: 403 }\n      );\n    }\n\n    // Verify new owner exists\n    const newOwner = await prisma.user.findUnique({\n      where: { id: newOwnerId },\n      select: { id: true, firstName: true, lastName: true, email: true }\n    });\n\n    if (!newOwner) {\n      return NextResponse.json(\n        { error: 'New owner user not found' },\n        { status: 404 }\n      );\n    }\n\n    // Transfer ownership\n    const updatedVenue = await prisma.venue.update({\n      where: { id: venueId },\n      data: { ownerId: newOwnerId },\n      include: {\n        owner: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            email: true\n          }\n        }\n      }\n    });\n\n    // Create a log entry for the ownership transfer\n    await prisma.venueOwnershipLog.create({\n      data: {\n        venueId,\n        previousOwnerId: currentOwnerId,\n        newOwnerId,\n        reason: reason || 'Manual ownership transfer',\n        transferredAt: new Date()\n      }\n    });\n\n    return NextResponse.json({\n      message: 'Venue ownership transferred successfully',\n      venue: updatedVenue\n    });\n  } catch (error) {\n    console.error('Error transferring venue ownership:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/venues/[venueId]/ownership\n * Request venue ownership (when there's no owner or after multiple expired requests)\n */\nexport async function POST(request: NextRequest, { params }: { params: { venueId: string } }) {\n  try {\n    const { venueId } = params;\n    const body = await request.json();\n    const { requesterId, reason } = body;\n\n    if (!requesterId) {\n      return NextResponse.json(\n        { error: 'Requester ID is required' },\n        { status: 400 }\n      );\n    }\n\n    // Verify venue exists\n    const venue = await prisma.venue.findUnique({\n      where: { id: venueId },\n      include: { owner: true }\n    });\n\n    if (!venue) {\n      return NextResponse.json(\n        { error: 'Venue not found' },\n        { status: 404 }\n      );\n    }\n\n    // Check if venue already has an owner\n    if (venue.ownerId) {\n      // Check if requester has at least 3 expired edit requests\n      const expiredRequests = await prisma.venueEditRequest.count({\n        where: {\n          venueId,\n          requesterId,\n          status: 'EXPIRED'\n        }\n      });\n\n      if (expiredRequests < 3) {\n        return NextResponse.json(\n          { error: 'You need at least 3 expired edit requests to claim ownership of this venue' },\n          { status: 400 }\n        );\n      }\n    }\n\n    // Verify requester exists\n    const requester = await prisma.user.findUnique({\n      where: { id: requesterId },\n      select: { id: true, firstName: true, lastName: true, email: true }\n    });\n\n    if (!requester) {\n      return NextResponse.json(\n        { error: 'Requester user not found' },\n        { status: 404 }\n      );\n    }\n\n    // Transfer ownership\n    const updatedVenue = await prisma.venue.update({\n      where: { id: venueId },\n      data: { ownerId: requesterId },\n      include: {\n        owner: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            email: true\n          }\n        }\n      }\n    });\n\n    // Create a log entry for the ownership claim\n    await prisma.venueOwnershipLog.create({\n      data: {\n        venueId,\n        previousOwnerId: venue.ownerId,\n        newOwnerId: requesterId,\n        reason: reason || 'Claimed ownership after expired requests',\n        transferredAt: new Date()\n      }\n    });\n\n    return NextResponse.json({\n      message: 'Venue ownership claimed successfully',\n      venue: updatedVenue\n    });\n  } catch (error) {\n    console.error('Error claiming venue ownership:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"