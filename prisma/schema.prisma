// Prisma Schema for Scotch Doubles Chip Tournament System
// Pool hall tournament management - corrected based on real requirements

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Age restriction enums
enum PlayerAgeGroup {
  UNDER_18  // <18 (Minors)
  AGES_18_20 // 18-20
  AGES_21_PLUS // 21+
}

enum VenueAgeRestriction {
  MINORS_ALLOWED_ALL_DAY           // Minors (<18) Allowed All Day
  MINORS_ALLOWED_LIMITED_HOURS     // Minors (<18) Allowed Limited Hours
  MINORS_AND_18_20_LIMITED_HOURS   // Minors (<18) Allowed & 18-20 Limited Hours
  NO_MINORS_18_PLUS_ALL_DAY        // No Minors (18+ All Day)
  AGES_18_20_LIMITED_HOURS         // 18-20 Allowed Limited Hours
  AGES_21_PLUS_ALL_DAY             // 21+ All Day
}

enum TableAgeRestriction {
  UNDER_18     // <18
  AGES_18_20   // 18-20
  AGES_21_PLUS // 21+
}

// Core models for tournament management
model Player {
  id        String   @id @default(cuid())
  email     String   @unique
  firstName String
  lastName  String
  phone     String?
  
  // Age system (replaces birth date)
  ageGroup  PlayerAgeGroup @default(AGES_21_PLUS)
  
  // Birthday chip tracking (month/day only, no year)
  birthdayMonth     Int? // 1-12
  birthdayDay       Int? // 1-31
  lastBirthdayChip  DateTime? // When they last received a birthday chip
  
  // Player skill ratings
  fargoRating       Int? // Overall Fargo rating (-100 to 900)
  apaEightBallRank  String? // APA 8-ball rank
  apaNineBallRank   String? // APA 9-ball rank
  inHouseRating     String? // Venue-specific rating

  // Player preferences and settings
  settings  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  tournamentProfiles PlayerProfile[]
  directorRoles     TournamentDirector[]
  sidePotEntries    SidePotEntry[] // Individual side pot entries
  errorLogs         ErrorLog[] @relation("PlayerErrors")
  ownedVenues       Venue[] @relation("VenueOwner")
  createdVenues     Venue[] @relation("VenueCreator")
  ageOverrides      PlayerAgeOverride[]
  venueEditRequests VenueEditRequest[]
  createdAgeOverrides PlayerAgeOverride[] @relation("AgeOverrideCreator")
  reviewedVenueEditRequests VenueEditRequest[] @relation("VenueEditReviewer")
  previousVenueOwnerships VenueOwnershipLog[] @relation("VenuePreviousOwner")
  newVenueOwnerships VenueOwnershipLog[] @relation("VenueNewOwner")

  @@map("players")
}

// Venue management for pool halls
model Venue {
  id          String   @id @default(cuid())
  name        String
  address     String?
  phone       String?
  email       String?
  
  // Age restriction system
  ageRestriction     VenueAgeRestriction @default(MINORS_ALLOWED_ALL_DAY)
  minorStartTime     String? // HH:MM format
  minorEndTime       String? // HH:MM format  
  ages18To20StartTime String? // HH:MM format
  ages18To20EndTime   String? // HH:MM format
  
  // Table age restriction management
  useVenueAgeForAllTables Boolean @default(true) // Apply Venue Age Restriction to All Tables vs Set Table Age Restrictions Manually
  
  // Venue ownership and editing
  ownerId     String? // Tournament Director who owns this venue
  createdById String? // Who originally created this venue
  
  // Table management
  totalTables Int
  settings    Json? // Operating hours, rules, etc.
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  tournaments Tournament[]
  tables      Table[]
  owner       Player? @relation("VenueOwner", fields: [ownerId], references: [id])
  createdBy   Player? @relation("VenueCreator", fields: [createdById], references: [id])
  editRequests VenueEditRequest[]
  ownershipLogs VenueOwnershipLog[]

  @@map("venues")
}

model Table {
  id        String @id @default(cuid())
  venueId   String
  number    String // Table identifier (1, 2, "Bar Table", etc.)
  isActive  Boolean @default(true)
  
  // Table age restriction (only used when venue.useVenueAgeForAllTables = false)
  ageRestriction TableAgeRestriction?
  
  // Table status
  status    TableStatus @default(OPEN)
  settings  Json? // Table-specific settings
  
  // Current assignment
  currentWinningTeamId String? // Team that stays at table
  lastAssignedAt       DateTime? // When teams were last assigned
  
  // Director controls
  closedBy    String? // Director who closed the table
  closedAt    DateTime? // When table was closed
  
  // Relationships
  venue     Venue @relation(fields: [venueId], references: [id], onDelete: Cascade)
  games     Game[]
  assignedTeams Team[] // Teams currently assigned to this table
  assignments TeamAssignment[] // Assignment history

  @@unique([venueId, number])
  @@map("tables")
}

enum TableStatus {
  OPEN      // Available for assignment
  IN_USE    // Currently has teams playing
  CLOSED    // Manually closed by director/manager
}

// Tournament management with proper roles
// Tournament management with complete configuration
model Tournament {
  id          String          @id @default(cuid())
  name        String
  description String?         @db.VarChar(5000) // 5000 character limit
  venueId     String
  
  // Tournament type configuration
  tournamentType TournamentType  @default(CHIP)
  playerType     PlayerType      @default(SCOTCH_DOUBLES)
  gameType       GameType        @default(NINE_BALL)
  status         TournamentStatus @default(SETUP)
  
  // Age restriction system (for tournaments without venues)
  isAgeRestricted     Boolean @default(false) // Age Restricted checkbox
  useUniformAgeRestriction Boolean? // Apply Age Restriction to All Tables vs Set Table Age Restrictions Manually 
  uniformAgeRestriction    TableAgeRestriction? // 21+ or 18+ when useUniformAgeRestriction = true
  
  // Tournament timing
  startDate      DateTime?
  endDate        DateTime?
  
  // Entry and chip configuration
  estimatedEntrants  Int?
  playersPerTable    Int @default(4) // Total players at table
  
  // Default chips configuration with Fargo-based ranges
  defaultChipsPerPlayer Int @default(3)
  chipRanges           Json? // Array of {minFargo, maxFargo, chips} objects
  
  // Race configuration
  raceToWins     Int @default(1) // Games needed to win a match
  
  // Tournament flow settings
  bracketOrdering   BracketOrdering @default(RANDOM_DRAW)
  autopilotMode     Boolean @default(false) // Auto-assign avoiding repeats
  randomOrderingEachRound Boolean @default(false) // Shuffle queue each round
  
  // Rules and rating system
  rules         Rules @default(BCA)
  ratingSystem  RatingSystem @default(FARGO_RATE)
  showSkillLevels Boolean @default(true) // Show ratings in bracket
  
  // Money configuration (all optional)
  entryFee      Decimal? @db.Decimal(10,2) // Per entrant
  adminFee      Decimal? @db.Decimal(10,2) // Per entrant (goes to director)
  addedMoney    Decimal? @db.Decimal(10,2) // Flat amount added to pot
  
  // Payout structure configuration
  payoutType         PayoutType? // PLACES or PERCENTAGE
  payoutPlacesSetting PayoutPlacesSetting? // Winner take all, top 2, etc.
  payoutPercentage   Int? // 10%, 15%, 20%, etc. (when using percentage type)
  customPayoutStructure Json? // Manual payout structure
  
  // Money visibility settings
  moneyVisible       Boolean @default(true) // Can be toggled by director
  moneyVisibleBefore Boolean @default(true) // Show money before tournament
  moneyVisibleDuring Boolean @default(true) // Show money during tournament  
  moneyVisibleAfter  Boolean @default(true) // Show money after tournament
  
  // Access control
  access        AccessType @default(PUBLIC)
  
  // Tournament progression
  isStarted      Boolean @default(false)
  isCompleted    Boolean @default(false)
  currentRound   Int @default(0)
  
  // Template functionality
  isTemplate     Boolean @default(false) // Can be saved as template
  templateName   String? // Name when saved as template
  
  // Auto settings
  autoAcceptScores Boolean @default(false) // Auto-accept vs manual approval
  allowNotifications Boolean @default(true) // SMS/push when teams assigned
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relationships
  venue          Venue @relation(fields: [venueId], references: [id])
  directors      TournamentDirector[]
  playerProfiles PlayerProfile[]
  teams          Team[]
  games          Game[]
  chipTransactions ChipTransaction[]
  payouts        Payout[]
  payoutSplits   PayoutSplit[] // Manual payout splits at end
  sidePots       SidePot[]
  teamPairings   TeamPairing[]
  queue          TournamentQueue?
  teamAssignments TeamAssignment[]
  errorLogs      ErrorLog[] @relation("TournamentErrors")
  ageOverrides   PlayerAgeOverride[]

  @@map("tournaments")
}

model TournamentDirector {
  id           String @id @default(cuid())
  tournamentId String
  playerId     String
  role         DirectorRole
  createdAt    DateTime @default(now())

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  player       Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, playerId])
  @@map("tournament_directors")
}

model PlayerProfile {
  id           String @id @default(cuid())
  tournamentId String
  playerId     String
  
  // Tournament-specific player data
  displayName  String
  skillLevel   String?
  handicap     Int? // For future use
  
  // Registration status
  registrationStatus PlayerRegistrationStatus @default(PENDING)
  registeredAt       DateTime @default(now())
  checkedInAt        DateTime?
  
  // Birthday chip tracking
  receivedBirthdayChip Boolean @default(false)
  birthdayChipDate     DateTime?
  
  // Settings for this tournament
  settings     Json?
  
  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  player       Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  teamMemberships TeamMember[]
  gameResults  GameResult[]
  chipTransactions ChipTransaction[]

  @@unique([tournamentId, playerId])
  @@map("player_profiles")
}

model Team {
  id           String @id @default(cuid())
  tournamentId String
  name         String
  
  // Team status and chip tracking
  status       TeamStatus @default(ACTIVE)
  currentChips Int @default(0) // Current chip count
  totalChipsWon Int @default(0) // Total chips won throughout tournament
  totalChipsLost Int @default(0) // Total chips lost
  
  // Initial chip calculation from combined Fargos
  combinedFargo Int? // Sum of both players' Fargo ratings
  initialChips  Int? // Chips calculated from Fargo ratings
  manualChipOverride Boolean @default(false) // Director manually set chips
  
  // Queue and bracket management
  queuePosition Int? // Position in waiting queue (null if not queued)
  seed         Int? // Initial bracket seeding
  isQueued     Boolean @default(false) // Currently in queue for assignment
  
  // Current table assignment
  currentTableId String? // Table they're currently assigned to (if any)
  assignedAt     DateTime? // When they were assigned to current table
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  members      TeamMember[]
  gamesAsWinner Game[] @relation("WinningTeam")
  gamesAsLoser  Game[] @relation("LosingTeam")
  chipTransactions ChipTransaction[] // Team chip tracking
  currentTable Table? @relation(fields: [currentTableId], references: [id]) // Current table assignment
  assignments  TeamAssignment[] // Assignment history
  payouts      Payout[] // Payouts earned
  sidePotEntries SidePotEntry[] // Side pot entries
  
  // Pairing history
  pairingsAsTeam1 TeamPairing[] @relation("Team1Pairings")
  pairingsAsTeam2 TeamPairing[] @relation("Team2Pairings")

  @@map("teams")
}

model TeamMember {
  id              String @id @default(cuid())
  teamId          String
  playerProfileId String
  position        String? // "Player 1", "Player 2" for Scotch Doubles
  isActive        Boolean @default(true)
  joinedAt        DateTime @default(now())

  // Relationships
  team          Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  playerProfile PlayerProfile @relation(fields: [playerProfileId], references: [id], onDelete: Cascade)

  @@unique([teamId, playerProfileId])
  @@map("team_members")
}

model Game {
  id           String @id @default(cuid())
  tournamentId String
  tableId      String?
  
  // Game identification
  gameNumber   Int
  round        Int?
  gameType     String @default("pool") // Pool, darts, etc.
  
  // Teams involved (no home/away concept)
  winningTeamId String?
  losingTeamId  String?
  
  // Game status and timing
  status       GameStatus @default(NOT_STARTED)
  startedAt    DateTime?
  completedAt  DateTime?
  
  // Match configuration (race-to-X)
  raceToWins   Int @default(1) // Games needed to win the match
  
  // Game results
  winnerStays  Boolean @default(true) // Winner stays at table
  chipsAwarded Int @default(1) // Chips awarded to winner
  
  // Score tracking
  winningTeamScore Int @default(0) // Games won by winning team
  losingTeamScore  Int @default(0) // Games won by losing team
  
  // Scoring approval
  scoresSubmitted Boolean @default(false) // Scores have been submitted
  scoresApproved  Boolean @default(false) // Scores approved by director
  submittedBy     String? // Player who submitted scores
  approvedBy      String? // Director who approved scores
  
  // Game-specific data
  gameData     Json? // Rack info, break player, etc.
  notes        String?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  table        Table? @relation(fields: [tableId], references: [id])
  winningTeam  Team? @relation("WinningTeam", fields: [winningTeamId], references: [id])
  losingTeam   Team? @relation("LosingTeam", fields: [losingTeamId], references: [id])
  results      GameResult[]
  chipTransactions ChipTransaction[] // Chip transactions from this game

  @@map("games")
}

model GameResult {
  id              String @id @default(cuid())
  gameId          String
  playerProfileId String
  
  // Individual player performance in the game
  score           Int? // Individual score if applicable
  performance     Json? // Detailed performance metrics
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships
  game            Game @relation(fields: [gameId], references: [id], onDelete: Cascade)
  playerProfile   PlayerProfile @relation(fields: [playerProfileId], references: [id], onDelete: Cascade)

  @@unique([gameId, playerProfileId])
  @@map("game_results")
}

// Chip transactions for team chip tracking
model ChipTransaction {
  id              String @id @default(cuid())
  tournamentId    String
  playerProfileId String?
  teamId          String? // Team chips belong to
  gameId          String?
  
  // Transaction details
  type            ChipTransactionType
  amount          Int // Positive for awards, negative for losses
  reason          String?
  description     String?
  
  // Context
  createdAt       DateTime @default(now())
  createdBy       String? // Player/director who created

  // Relationships
  tournament      Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  playerProfile   PlayerProfile? @relation(fields: [playerProfileId], references: [id])
  team            Team? @relation(fields: [teamId], references: [id]) // Team relationship
  game            Game? @relation(fields: [gameId], references: [id]) // Game context

  @@map("chip_transactions")
}

// Payout structure for tournaments with split functionality
model Payout {
  id           String @id @default(cuid())
  tournamentId String
  
  // Payout details
  position     Int // 1st, 2nd, 3rd, etc.
  amount       Decimal @db.Decimal(10,2)
  percentage   Decimal? @db.Decimal(5,2) // Percentage of total pot
  description  String? // "1st Place", "Runner-up", etc.
  
  // Payout recipient
  teamId       String? // Team that earned this position
  
  // Payout status
  isPaid       Boolean @default(false)
  paidAt       DateTime?
  
  // Original vs split amounts
  originalAmount Decimal? @db.Decimal(10,2) // Amount before any splits
  isSplit        Boolean @default(false) // Part of a manual split
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  team         Team? @relation(fields: [teamId], references: [id])

  @@map("payouts")
}

// Manual payout splits for end-of-tournament scenarios
model PayoutSplit {
  id           String @id @default(cuid())
  tournamentId String
  
  // Split details
  splitName    String // "Final 3 Teams Split", "1st/2nd Place Split", etc.
  description  String? // Reason for split
  totalAmount  Decimal @db.Decimal(10,2) // Total amount being split
  
  // Split recipients (JSON array of {teamId, amount, percentage})
  splitData    Json // [{"teamId": "...", "amount": 100.00, "percentage": 50.0}]
  
  // Split metadata
  createdBy    String? // Director who created the split
  createdAt    DateTime @default(now())

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@map("payout_splits")
}

// Side pots for additional betting/prizes (up to 10 per tournament)
model SidePot {
  id           String @id @default(cuid())
  tournamentId String
  
  // Side pot details
  name         String // "Break and Run", "High Run", etc.
  description  String?
  entryFee     Decimal @db.Decimal(10,2) // Entry fee for this side pot
  totalPot     Decimal @default(0) @db.Decimal(10,2) // Total collected
  
  // Entry type
  entryType    SidePotEntryType @default(TEAM) // TEAM or INDIVIDUAL
  
  // Qualification criteria
  criteria     Json // Flexible criteria definition
  
  // Status and winner
  isActive     Boolean @default(true)
  isComplete   Boolean @default(false)
  winnerId     String? // Winner team or player ID
  winnerType   SidePotWinnerType? // TEAM or PLAYER
  paidOut      Boolean @default(false)
  paidAt       DateTime?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  entries      SidePotEntry[] // Track entries

  @@map("side_pots")
}

// Track side pot entries
model SidePotEntry {
  id           String @id @default(cuid())
  sidePotId    String
  
  // Entry details
  entrantType  SidePotEntryType // TEAM or INDIVIDUAL
  teamId       String?
  playerId     String? // For individual entries
  
  // Entry status
  entryFee     Decimal @db.Decimal(10,2)
  isPaid       Boolean @default(false)
  enteredAt    DateTime @default(now())

  // Relationships
  sidePot      SidePot @relation(fields: [sidePotId], references: [id], onDelete: Cascade)
  team         Team? @relation(fields: [teamId], references: [id])
  player       Player? @relation(fields: [playerId], references: [id])

  @@unique([sidePotId, teamId])
  @@unique([sidePotId, playerId])
  @@map("side_pot_entries")
}

// Team pairing history to avoid repeat matchups
model TeamPairing {
  id           String @id @default(cuid())
  tournamentId String
  team1Id      String
  team2Id      String
  
  // Pairing statistics
  timesPlayed  Int @default(1) // How many times these teams have played
  lastPlayed   DateTime @default(now()) // When they last played
  
  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  team1        Team @relation("Team1Pairings", fields: [team1Id], references: [id], onDelete: Cascade)
  team2        Team @relation("Team2Pairings", fields: [team2Id], references: [id], onDelete: Cascade)

  @@unique([tournamentId, team1Id, team2Id])
  @@map("team_pairings")
}

// Tournament queue management
model TournamentQueue {
  id           String @id @default(cuid())
  tournamentId String
  
  // Queue state
  queueData    Json // Serialized queue of team IDs in order
  lastShuffled DateTime? // When queue was last shuffled
  shuffledBy   String? // Director who last shuffled
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([tournamentId])
  @@map("tournament_queues")
}

// Team assignment notifications
model TeamAssignment {
  id           String @id @default(cuid())
  tournamentId String
  teamId       String
  tableId      String
  
  // Assignment details
  assignmentType AssignmentType // INITIAL, WINNER_STAYS, FROM_QUEUE
  assignedBy   String? // Director who made assignment
  
  // Notification status
  notificationSent Boolean @default(false)
  sentAt           DateTime?
  
  createdAt    DateTime @default(now())

  // Relationships
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  team         Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  table        Table @relation(fields: [tableId], references: [id], onDelete: Cascade)

  @@map("team_assignments")
}

// System models for audit, notifications, and administration
model AuditLog {
  id           String @id @default(cuid())
  
  // Event identification
  entityType   String   // Table/model name
  entityId     String   // Record ID
  action       AuditAction
  
  // Change tracking
  oldValues    Json?
  newValues    Json?
  
  // Context
  userId       String?
  sessionId    String?
  ipAddress    String?
  userAgent    String?
  
  // Metadata
  timestamp    DateTime @default(now())
  
  @@map("audit_logs")
}

// Player age override system for tournament-specific age settings
model PlayerAgeOverride {
  id           String @id @default(cuid())
  playerId     String
  tournamentId String
  originalAge  PlayerAgeGroup
  overrideAge  PlayerAgeGroup
  createdById  String // TD who created the override
  reason       String? // Optional reason for override
  
  createdAt    DateTime @default(now())
  expiresAt    DateTime? // Automatically removed when tournament ends
  
  // Relationships
  player       Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)  
  createdBy    Player @relation("AgeOverrideCreator", fields: [createdById], references: [id])
  
  @@unique([playerId, tournamentId])
  @@map("player_age_overrides")
}

// Venue edit request system for ownership and approval workflow
model VenueEditRequest {
  id          String @id @default(cuid())
  venueId     String
  requesterId String // TD requesting the edit
  
  // Edit data
  proposedChanges Json // What they want to change
  status          VenueEditRequestStatus @default(PENDING)
  reviewedById    String? // Owning TD who reviewed
  rejectionReason String? // Reason for rejection if status = REJECTED
  
  // Timing
  createdAt   DateTime @default(now())
  reviewedAt  DateTime?
  expiresAt   DateTime // 48 hours from creation
  
  // Relationships  
  venue       Venue @relation(fields: [venueId], references: [id], onDelete: Cascade)
  requester   Player @relation(fields: [requesterId], references: [id])
  reviewedBy  Player? @relation("VenueEditReviewer", fields: [reviewedById], references: [id])
  
  @@map("venue_edit_requests")
}

model VenueOwnershipLog {
  id               String @id @default(cuid())
  venueId          String
  previousOwnerId  String? // null if venue had no previous owner
  newOwnerId       String
  reason           String? // Reason for transfer
  transferredAt    DateTime @default(now())
  
  // Relationships
  venue            Venue @relation(fields: [venueId], references: [id], onDelete: Cascade)
  previousOwner    Player? @relation("VenuePreviousOwner", fields: [previousOwnerId], references: [id])
  newOwner         Player @relation("VenueNewOwner", fields: [newOwnerId], references: [id])
  
  @@map("venue_ownership_logs")
}

model Notification {
  id           String @id @default(cuid())
  
  // Recipient
  userId       String?
  email        String?
  
  // Content
  type         NotificationType
  title        String
  message      String
  data         Json?    // Additional notification data
  
  // Delivery
  channel      NotificationChannel
  status       NotificationStatus @default(PENDING)
  sentAt       DateTime?
  readAt       DateTime?
  
  // Metadata
  createdAt    DateTime @default(now())
  
  @@map("notifications")
}

model SystemConfig {
  id          String @id @default(cuid())
  key         String @unique
  value       String
  type        ConfigType
  description String?
  updatedAt   DateTime @updatedAt
  updatedBy   String?

  @@map("system_config")
}

// Error logging
model ErrorLog {
  id            String    @id @default(cuid())
  code          String
  message       String
  category      String
  severity      String
  context       String?   // JSON string of context data
  stack         String?   // Error stack trace
  
  // Tracking
  userId        String?
  tournamentId  String?
  correlationId String?   // For tracking related operations
  
  // Timestamps
  createdAt     DateTime  @default(now())
  
  // Relations
  user         Player?      @relation("PlayerErrors", fields: [userId], references: [id])
  tournament   Tournament?  @relation("TournamentErrors", fields: [tournamentId], references: [id])
  
  @@index([category, createdAt])
  @@index([severity, createdAt])
  @@index([correlationId])
  @@map("error_logs")
}

// Updated enum definitions for pool hall tournaments
enum DirectorRole {
  TOURNAMENT_DIRECTOR
  TOURNAMENT_MANAGER
  ADMIN
  VIEWER
}

enum TournamentType {
  CHIP
  // Future: BRACKET, ROUND_ROBIN when needed
}

enum PlayerType {
  SINGLES           // 1v1
  DOUBLES          // 2v2
  SCOTCH_DOUBLES   // 2v2 alternating shot
}

enum GameType {
  EIGHT_BALL
  NINE_BALL
  TEN_BALL
}

enum BracketOrdering {
  RANDOM_DRAW      // Fisher-Yates shuffle
  SEEDED_DRAW      // Highest vs lowest seed
  SET_ORDER        // Manual seed assignment
}

enum Rules {
  BCA
  APA
  WPA
  USAPL
  VNEA
  LOCAL
}

enum RatingSystem {
  NONE
  FARGO_RATE
  APA
  IN_HOUSE
}

enum PayoutType {
  PLACES
  PERCENTAGE
}

enum PayoutPlacesSetting {
  WINNER_TAKE_ALL    // 1-4 entries
  TOP_2             // 5-8 entries  
  TOP_3             // 9-16 entries
  TOP_4             // 17-24 entries
  TOP_6             // 25-31 entries
  TOP_8             // 32-64 entries
  CUSTOM
}

enum AccessType {
  PUBLIC
  PRIVATE
}

enum SidePotEntryType {
  TEAM
  INDIVIDUAL
}

enum SidePotWinnerType {
  TEAM
  PLAYER
}

enum TournamentStatus {
  SETUP
  REGISTRATION_OPEN
  REGISTRATION_CLOSED
  IN_PROGRESS
  PAUSED
  COMPLETED
  CANCELLED
}

enum TeamStatus {
  ACTIVE
  INACTIVE
  ELIMINATED
}

enum PlayerRegistrationStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  WAITLISTED
  DECLINED
}

enum GameStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ChipTransactionType {
  INITIAL_CHIPS
  BIRTHDAY_CHIP
  GAME_WIN
  GAME_LOSS
  MANUAL_ADJUSTMENT
  BUY_IN
}

enum AssignmentType {
  INITIAL
  WINNER_STAYS
  FROM_QUEUE
}

enum VenueEditRequestStatus {
  PENDING
  APPROVED
  REJECTED
  EXPIRED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
}

enum NotificationType {
  GAME_ASSIGNMENT
  TOURNAMENT_START
  TOURNAMENT_END
  PAYOUT_NOTIFICATION
  GENERAL
}

enum NotificationChannel {
  EMAIL
  SMS
  PUSH
  IN_APP
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  READ
}

enum ConfigType {
  STRING
  NUMBER
  BOOLEAN
  JSON
}

